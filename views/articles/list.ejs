<!-- Page Header -->
<div class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h1 class="text-3xl font-bold text-gray-900">Liste des Articles</h1>
        <p class="text-lg text-gray-600 mt-2">
            Parcourez tous les articles du Code Général des Impôts marocain
        </p>
    </div>
</div>

<!-- Main Content -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Filters -->
    <div class="filters-section">
        <form method="GET" class="filters-form">
            <div class="filters-row">
                <div class="filter-group">
                    <label for="query">Recherche</label>
                    <input type="text" name="query" id="query" value="<%= filters.query %>" placeholder="Rechercher par numéro ou contenu...">
                </div>
                
                <div class="filter-group">
                    <label for="annee">Année</label>
                    <select name="annee" id="annee">
                        <option value="">Toutes les années</option>
                        <% years.forEach(year => { %>
                            <option value="<%= year %>" <%= filters.annee == year ? 'selected' : '' %>><%= year %></option>
                        <% }); %>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="sortBy">Trier par</label>
                    <select name="sortBy" id="sortBy">
                        <option value="id" <%= filters.sortBy === 'id' ? 'selected' : '' %>>Numéro d'article</option>
                        <option value="titre" <%= filters.sortBy === 'titre' ? 'selected' : '' %>>Titre</option>
                        <option value="annee" <%= filters.sortBy === 'annee' ? 'selected' : '' %>>Année</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="sortOrder">Ordre</label>
                    <select name="sortOrder" id="sortOrder">
                        <option value="asc" <%= filters.sortOrder === 'asc' ? 'selected' : '' %>>Croissant</option>
                        <option value="desc" <%= filters.sortOrder === 'desc' ? 'selected' : '' %>>Décroissant</option>
                    </select>
                </div>
                
                <div class="filter-actions">
                    <button type="submit" class="btn btn-primary">Filtrer</button>
                    <a href="/articles" class="btn btn-secondary">Réinitialiser</a>
                </div>
            </div>
        </form>
    </div>

    <!-- Results -->
    <div class="results-section">
        <div class="results-header">
            <div class="results-info">
                <h2>Résultats</h2>
                <p class="results-count">
                    <%= pagination.total %> article<%= pagination.total > 1 ? 's' : '' %> trouvé<%= pagination.total > 1 ? 's' : '' %>
                </p>
            </div>
            <div class="results-actions">
                <span class="page-info">
                    Page <%= pagination.currentPage %> sur <%= pagination.totalPages %>
                </span>
            </div>
        </div>

        <!-- Articles List -->
        <div class="articles-list">
            <% if (articles.length > 0) { %>
                <% articles.forEach(article => { %>
                    <article class="article-item">
                        <div class="article-main">
                            <div class="article-header">
                                <span class="article-number"><%= article.numero_article %></span>
                                <span class="article-year"><%= article.annee %></span>
                            </div>
                            <h3 class="article-title">
                                <a href="/articles/<%= article.id %>"><%= article.titre %></a>
                            </h3>
                            <div class="article-content">
                                <%= article.content ? article.content.substring(0, 300) + '...' : 'Aucun contenu disponible' %>
                            </div>
                            <div class="article-meta">
                                <% if (article.references && article.references.length > 0) { %>
                                    <span class="references-count">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                        </svg>
                                        <%= article.references.length %> référence<%= article.references.length > 1 ? 's' : '' %>
                                    </span>
                                <% } %>
                            </div>
                        </div>
                        <div class="article-actions">
                            <a href="/articles/<%= article.id %>" class="btn btn-primary">Lire</a>
                            <a href="/articles/<%= article.id %>/pdf" class="btn btn-secondary">PDF</a>
                        </div>
                    </article>
                <% }); %>
            <% } else { %>
                <div class="no-results">
                    <div class="no-results-icon">
                        <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <h3>Aucun article trouvé</h3>
                    <p>Essayez de modifier vos critères de recherche</p>
                    <a href="/articles" class="btn btn-primary mt-4">Voir tous les articles</a>
                </div>
            <% } %>
        </div>

        <!-- Pagination -->
        <% if (pagination.totalPages > 1) { %>
            <div class="pagination">
                <% if (pagination.currentPage > 1) { %>
                    <a href="?<%= new URLSearchParams({...filters, page: pagination.currentPage - 1}) %>" class="pagination-btn">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Précédent
                    </a>
                <% } %>

                <div class="pagination-numbers">
                    <% 
                    const startPage = Math.max(1, pagination.currentPage - 2);
                    const endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);
                    %>
                    <% for (let i = startPage; i <= endPage; i++) { %>
                        <a href="?<%= new URLSearchParams({...filters, page: i}) %>" 
                           class="pagination-number <%= i === pagination.currentPage ? 'active' : '' %>">
                            <%= i %>
                        </a>
                    <% } %>
                </div>

                <% if (pagination.currentPage < pagination.totalPages) { %>
                    <a href="?<%= new URLSearchParams({...filters, page: pagination.currentPage + 1}) %>" class="pagination-btn">
                        Suivant
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                <% } %>
            </div>
        <% } %>
    </div>
</div>